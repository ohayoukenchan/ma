# Edge Skate: iOS AR Skateboarding Concept

## 概要
iPhone/iPadのカメラで撮影した写真・動画からエッジを抽出し、その線上をスケートボードが走るアニメーションを生成するアプリの設計概要をまとめます。リアルタイム解析と物理挙動を組み合わせ、撮影した環境の地形やオブジェクトをコースとして活用することを目指します。

## ユースケース
- その場で撮影した映像にバーチャルのスケートボーダーを重ね、SNSに共有する。
- ギャラリーから選んだ写真にカスタムコースを生成し、トリック再生を楽しむ。
- 教育用途として、エッジ検出や画像解析のデモアプリに活用する。

## アーキテクチャ概要
| レイヤー | 役割 | 主要技術 |
| --- | --- | --- |
| UIレイヤー | カメラプレビュー、編集UI、プレイバックUI | SwiftUI, UIKit
| 映像入力レイヤー | カメラ/フォトライブラリからのフレーム取得 | AVFoundation, Photos Framework
| 画像解析レイヤー | エッジ検出、特徴点抽出、ライン化 | Vision, Core Image, Metal Performance Shaders
| コース生成レイヤー | エッジをグラフ化し走行コースを生成 | Swift, GameplayKit
| 物理シミュレーション | スケートボード挙動、トリックアニメ | SceneKit/RealityKit Physics
| レンダリング | 3Dキャラクター、パーティクル表現 | RealityKit, Metal
| 保存/共有 | 動画エクスポート、SNS共有 | AVAssetWriter, UIActivityViewController

## コア機能フロー
1. **映像入力**: ユーザーが写真または動画を選択。動画の場合はAVAssetからフレームを抽出。
2. **前処理**: 解像度調整、ノイズ除去、彩度/コントラストの最適化。
3. **エッジ抽出**:
   - Core Imageの`CILaplacian`や`CIEdges`で初期マップを生成。
   - Visionフレームワークの`VNDetectContoursRequest`で輪郭を抽出し、ポリライン化。
4. **コース生成**:
   - 抽出した輪郭から走行可能なラインを選定。
   - 経路平滑化 (Catmull-Romスプライン) とポイント密度の正規化。
   - 高低差を推定（ステレオ対応やLiDARデバイスでは深度マップ併用）。
5. **物理シミュレーション**:
   - スケートボードモデルをSceneKit/RealityKit上に配置。
   - 速度、加速度、摩擦を調整し、コースに沿ってキーフレーム生成。
   - トリックアクション（オーリー等）をイベントとして挿入。
6. **レンダリングと合成**:
   - カメラ映像上にAR的に重ね合わせる。
   - ライティング推定（ARKitの環境光推定）を適用。
7. **エクスポート/共有**:
   - RealityKitのシーングラフをAVAssetWriterで動画化。
   - SNS共有UIを提供。

## プロトタイプ計画
1. **MVP (2-3週間)**
   - 静止画からエッジ抽出し、単純なライン追従アニメーションを2Dオーバーレイ。
   - 簡易的なUIで写真選択とGIF/動画出力に対応。
2. **ベータ版 (6-8週間)**
   - 動画入力とリアルタイムプレビュー。
   - 3DモデルのスケートボーダーをRealityKitでレンダリング。
   - 基本的なトリックアニメーションとサウンド追加。
3. **製品版 (12週間〜)**
   - 深度情報活用による立体的コース生成。
   - コース編集ツール、スコアリング、SNS連携強化。
   - App Store配信準備 (課金/分析/プライバシーポリシー整備)。

## 技術的チャレンジと対策
- **エッジのノイズ問題**: 複数手法を組み合わせ、ユーザー調整可能な閾値スライダーを用意。
- **リアルタイム性**: Metalでエッジ検出をGPU処理し、Visionリクエストを非同期キューで実行。
- **物理挙動の自然さ**: 実測映像を基にパラメータチューニング。GameplayKitの`GKPath`や`GKAgent`を活用。
- **ユーザー体験**: チュートリアルとプリセットコースで学習曲線を低減。

## 今後の拡張
- マルチプレイヤー共有セッション（SharePlay）。
- ARKitのワールドマッピングで実世界の3D地形と統合。
- コミュニティによるコース共有プラットフォーム。

